<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles/style.css"/>
  <title>Card√°pio Digital</title>
</head>
<body>
  <div class="container">
    <header>
      <h1>
        <strong>
          üë©‚Äçüç≥¬∞‚Ä¢Jacantins¬∞‚Ä¢üë®‚Äçüç≥
        </strong>
      </h1>
      <hr>
    </header>
    
    <main>
      <button class="btn-elegant" onclick='iniciarCardapio()'>üçùAbrir Card√°pioüç¢</button>
      <button class="btn-elegant" onclick='verFilaAtual()'>üïí Ver Fila</button>
      <a href="https://www.google.com"><button class="btn-elegant">‚õîSair</button></a>
    </main>
  </div>
  
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import { getDatabase, ref, push, get } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCGg6A_HNAJ0qsB4gzYJgQK9E3ztISO-FM",
      authDomain: "cardapio-1d6f1.firebaseapp.com",
      projectId: "cardapio-1d6f1",
      storageBucket: "cardapio-1d6f1.firebasestorage.app",
      messagingSenderId: "841755407374",
      appId: "1:841755407374:web:115d312d354bb6e77df85f",
      measurementId: "G-CYH903V9W1"
    };

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    
    const menu = {
      aperitivos: [
        { nome: "Batata frita", preco: 15.00 },
        { nome: "Pastel de queijo", preco: 12.50 },
        { nome: "Calabresa acebolada", preco: 25.00 },
        { nome: "Bolinho de aipim com carne seca", preco: 22.00 },
        { nome: "Torresmo com lim√£o", preco: 18.00 },
        { nome: "Dadinho de tapioca", preco: 28.00 }
      ],
      pratosPrincipais: [
        { nome: "Risoto de cogumelos", preco: 45.00 },
        { nome: "Salm√£o com pur√™ de batata doce", preco: 60.00 },
        { nome: "Strogonoff de carne", preco: 55.00 },
        { nome: "Lasanha √† bolonhesa", preco: 48.00 },
        { nome: "Fil√© de frango grelhado com arroz e feij√£o", preco: 42.00 },
        { nome: "Picanha na chapa com mandioca frita", preco: 75.00 },
        { nome: "Til√°pia ao molho de camar√£o", preco: 68.00 },
        { nome: "Feijoada completa", preco: 50.00 },
        { nome: "Espaguete ao molho pesto com tomate cereja", preco: 40.00 },
        { nome: "Costela su√≠na com barbecue e batatas r√∫sticas", preco: 65.00 }
      ],
      sobremesas: [
        { nome: "Bolo de chocolate com sorvete", preco: 20.00 },
        { nome: "Pudim de leite condensado", preco: 18.00 },
        { nome: "Mousse de maracuj√°", preco: 15.00 },
        { nome: "Brownie com calda de chocolate", preco: 22.00 },
        { nome: "Pav√™ de biscoito", preco: 17.00 }
      ],
      bebidas: [
        { nome: "Refrigerante lata", preco: 7.00 },
        { nome: "Suco natural de laranja", preco: 9.00 },
        { nome: "√Ågua sem g√°s", preco: 5.00 },
        { nome: "Cerveja Pilsen", preco: 10.00 },
        { nome: "Refrigerante 2L", preco: 12.00 },
        { nome: "Suco natural de abacaxi com hortel√£", preco: 11.00 },
        { nome: "Chopp", preco: 12.50 }
      ]
    };
    
    const pedido = [];

    window.iniciarCardapio = function() {
      const idade = prompt("Qual a sua idade?");
      
      if (idade === null || isNaN(idade) || !Number.isInteger(Number(idade))) {
        alert("Idade inv√°lida. Por favor, digite um n√∫mero.");
        return;
      }
      
      const idadeNumerica = parseInt(idade, 10);
      
      if (idadeNumerica < 18) {
        alert("Voc√™ deve ter 18 anos ou mais para acessar o menu de bebidas alco√≥licas.");
        menu.bebidas = menu.bebidas.filter(item => item.nome !== "Cerveja Pilsen" && item.nome !== "Chopp");
      }

      let continuar = true;
      while (continuar) {
        const opcao = prompt(
          "Bem-vindo(a) ao nosso restaurante!\n\n" +
          "Escolha uma op√ß√£o:\n" +
          "1 - Aperitivos\n" +
          "2 - Pratos Principais\n" +
          "3 - Sobremesas\n" +
          "4 - Bebidas\n" +
          "5 - Ver Pedido e Pagamento\n" +
          "6 - Sair\n"
        );
        
        if (opcao === null) {
          continuar = false;
          alert("Obrigado por sua visita!");
          continue;
        }

        switch (opcao) {
          case '1':
            mostrarCategoria('aperitivos');
            break;
          case '2':
            mostrarCategoria('pratosPrincipais');
            break;
          case '3':
            mostrarCategoria('sobremesas');
            break;
          case '4':
            mostrarCategoria('bebidas');
            break;
          case '5':
            verPagamento();
            break;
          case '6':
            continuar = false;
            alert("Obrigado por sua visita!");
            break;
          default:
            alert("Op√ß√£o inv√°lida. Por favor, escolha um n√∫mero de 1 a 6.");
        }
      }
    }

    function mostrarCategoria(categoria) {
      let mensagem = `--- ${categoria.toUpperCase()} ---\n\n`;
      menu[categoria].forEach((item, index) => {
        mensagem += `${index + 1} - ${item.nome} (R$ ${item.preco.toFixed(2).replace(".", ",")})\n`;
      });

      const escolha = prompt(mensagem + "\nEscolha o n√∫mero do item que deseja adicionar ao pedido ou digite '0' para voltar.");
      
      if (escolha === null) return;

      const indice = parseInt(escolha, 10) - 1;
      if (indice >= 0 && indice < menu[categoria].length) {
        pedido.push(menu[categoria][indice]);
        alert(`${menu[categoria][indice].nome} foi adicionado ao seu pedido!`);
      } else if (escolha !== '0') {
        alert("Escolha inv√°lida. Voltando ao menu principal.");
      }
    }

    function verPagamento() {
      if (pedido.length === 0) {
        alert("Seu pedido est√° vazio.");
        return;
      }

      let total = 0;
      let mensagemPedido = "--- SEU PEDIDO ---\n\n";
      pedido.forEach(item => {
        mensagemPedido += `- ${item.nome} (R$ ${item.preco.toFixed(2).replace(".", ",")})\n`;
        total += item.preco;
      });

      mensagemPedido += `\nTotal: R$ ${total.toFixed(2).replace(".", ",")}`;
      
      const confirmar = confirm(mensagemPedido + "\n\nConfirmar e pagar?");
      
      if (confirmar) {
        const novoPedido = {
          items: pedido.map(item => item.nome),
          total: total,
          timestamp: Date.now()
        };
        
        const novaEntrada = push(ref(database, 'fila'), novoPedido);
        const chaveDoPedido = novaEntrada.key;
        alert("Pagamento processado com sucesso! Obrigado pela prefer√™ncia. Aguarde a sua vez na fila.");
        pedido.length = 0;
      } else {
        alert("Pagamento cancelado. Seu pedido ainda est√° salvo.");
      }
    }

    window.verFilaAtual = function() {
      const filaRef = ref(database, 'fila');

      get(filaRef).then((snapshot) => {
        let mensagemFila = "--- FILA ATUAL ---\n\n";
        let contador = 0;
        let pedidos = [];
        
        if (snapshot.exists()) {
          snapshot.forEach((childSnapshot) => {
            contador++;
            pedidos.push(`Pedido #${contador}`);
          });
          mensagemFila += pedidos.join("\n");
          alert(mensagemFila);
        } else {
          alert("N√£o h√° pedidos na fila no momento.");
        }
      }).catch((error) => {
        console.error(error);
        alert("Ocorreu um erro ao buscar a fila. Por favor, tente novamente.");
      });
    }

  </script>
</body>
</html>
